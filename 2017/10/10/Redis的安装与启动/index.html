<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/favicon.ico"><title>Redis的安装与启动</title><script src="/js/baidu_analytics.js"></script></head><body>　　<div class="inner"><h2>Redis的安装与启动</h2><p>redis的安装还是比较简单的，只不过有一些配置什么的需要注意，如果能设置为服务启动最好。</p>
<h2><span id="1解压文件">1.解压文件</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf redis-3.2.5.tar.gz</span><br></pre></td></tr></table></figure>

<h2><span id="2编译">2.编译</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd redis-3.2.5</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure>

<p>编译完成后，在./Src目录下，有三个可执行文件redis-server、redis-benchmark、redis-cli和./redis.conf然后拷贝到一个目录下。</p>
<h2><span id="3修改配置">3.修改配置</span></h2><p><code>vi redis.conf</code></p>
<p>注意几个点:</p>
<ol>
<li>bind 127.0.0.1 注释掉该句</li>
<li>顺便在下面一行添加 requirepass 123456</li>
<li>daemonize no 改为 daemonize yes</li>
</ol>
<h2><span id="4启动">4.启动</span></h2><p>进入src目录</p>
<p>执行<code>redis-server ../redis.conf</code></p>
<p>测试是否启动成功</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">redis&gt; <span class="built_in">set</span> foo bar</span><br><span class="line">OK</span><br><span class="line">redis&gt; get foo</span><br><span class="line"><span class="string">"bar"</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2><span id="5设置为服务">5.设置为服务</span></h2><p>如要创建一个名为redisd的文件，脚本内容在下方</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/rc.d/init.d/redisd</span><br><span class="line">$ chmod a+x /etc/rc.d/init.d/redisd</span><br><span class="line">$ cp /etc/rc.d/init.d/redisd /etc/init.d/redisd</span><br><span class="line">$ chmod a+x /etc/init.d/redisd</span><br><span class="line">$ chkconfig --add redisd	<span class="comment">#添加系统服务</span></span><br><span class="line">$ chkconfig redisd on	<span class="comment">#开机启动</span></span><br><span class="line">$ chkconfig --list redisd	<span class="comment">#查看</span></span><br></pre></td></tr></table></figure>

<p>脚本内容如下:</p>
<p><strong>注意脚本里面的路径需根据实际情况调整。</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#chkconfig: 345 86 14</span></span><br><span class="line"><span class="comment">#description: Startup and shutdown script for Redis</span></span><br><span class="line"></span><br><span class="line">REDISPORT=6379</span><br><span class="line">PROGDIR=/usr/<span class="built_in">local</span>/redis-3.2.5/src</span><br><span class="line">PROGNAME=redis-server</span><br><span class="line">DAEMON=<span class="variable">$PROGDIR</span>/<span class="variable">$PROGNAME</span></span><br><span class="line">CONFIG=/usr/<span class="built_in">local</span>/redis-3.2.5/redis.conf</span><br><span class="line">PIDFILE=/var/run/redis_<span class="variable">$&#123;REDISPORT&#125;</span>.pid</span><br><span class="line">DESC=<span class="string">"redis daemon"</span></span><br><span class="line">SCRIPTNAME=/etc/init.d/redisd</span><br><span class="line"></span><br><span class="line">start()</span><br><span class="line">&#123;</span><br><span class="line">         <span class="keyword">if</span> <span class="built_in">test</span> -x <span class="variable">$DAEMON</span></span><br><span class="line">         <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"Starting <span class="variable">$DESC</span>: <span class="variable">$PROGNAME</span>"</span></span><br><span class="line">                   <span class="keyword">if</span> <span class="variable">$DAEMON</span> <span class="variable">$CONFIG</span></span><br><span class="line">                   <span class="keyword">then</span></span><br><span class="line">                            <span class="built_in">echo</span> -e <span class="string">"OK"</span></span><br><span class="line">                   <span class="keyword">else</span></span><br><span class="line">                            <span class="built_in">echo</span> -e <span class="string">"failed"</span></span><br><span class="line">                   <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">                   <span class="built_in">echo</span> -e <span class="string">"Couldn't find Redis Server (<span class="variable">$DAEMON</span>)"</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop()</span><br><span class="line">&#123;</span><br><span class="line">         <span class="keyword">if</span> <span class="built_in">test</span> -e <span class="variable">$PIDFILE</span></span><br><span class="line">         <span class="keyword">then</span></span><br><span class="line">                   <span class="built_in">echo</span> -e <span class="string">"Stopping <span class="variable">$DESC</span>: <span class="variable">$PROGNAME</span>"</span></span><br><span class="line">                   <span class="keyword">if</span> <span class="built_in">kill</span> `cat <span class="variable">$PIDFILE</span>`</span><br><span class="line">                   <span class="keyword">then</span></span><br><span class="line">                            <span class="built_in">echo</span> -e <span class="string">"OK"</span></span><br><span class="line">                   <span class="keyword">else</span></span><br><span class="line">                            <span class="built_in">echo</span> -e <span class="string">"failed"</span></span><br><span class="line">                   <span class="keyword">fi</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">                   <span class="built_in">echo</span> -e <span class="string">"No Redis Server (<span class="variable">$DAEMON</span>) running"</span></span><br><span class="line">         <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"Restarting <span class="variable">$DESC</span>: <span class="variable">$PROGNAME</span>"</span></span><br><span class="line">    stop</span><br><span class="line">         start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">list()</span><br><span class="line">&#123;</span><br><span class="line">         ps aux | grep <span class="variable">$PROGNAME</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">         start)</span><br><span class="line">                   start</span><br><span class="line">        ;;</span><br><span class="line">         stop)</span><br><span class="line">        stop</span><br><span class="line">        ;;</span><br><span class="line">         restart)</span><br><span class="line">        restart</span><br><span class="line">        ;;</span><br><span class="line">         list)</span><br><span class="line">        list</span><br><span class="line">        ;;</span><br><span class="line"></span><br><span class="line">         *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$SCRIPTNAME</span> &#123;start|stop|restart|list&#125;"</span> &gt;&amp;2</span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<p>一切顺利之后，可以用如下命令管理redis服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ service redisd start</span><br><span class="line">$ service redisd stop</span><br><span class="line">$ service redisd restart</span><br><span class="line">$ service redisd list</span><br></pre></td></tr></table></figure>

<p><strong>如果遇到No such file or directory问题。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">解决方法</span><br><span class="line">分析原因，可能平台迁移碰到权限问题，我们来进行权限转换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1）在Windows下转换：</span><br><span class="line"></span><br><span class="line">利用一些编辑器如UltraEdit或EditPlus等工具先将脚本编码转换，再放到Linux中执行。转换方式如下（UltraEdit）：File--&gt;Conversions--&gt;DOS-&gt;UNIX即可。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2)方法</span><br><span class="line"></span><br><span class="line">用vim打开该sh文件，输入：</span><br><span class="line">[plain]</span><br><span class="line">:set ff</span><br><span class="line">回车，显示fileformat=dos，重新设置下文件格式：</span><br><span class="line">[plain]</span><br><span class="line">:set ff=unix</span><br><span class="line">保存退出:</span><br><span class="line">[plain]</span><br><span class="line">:wq</span><br><span class="line">再执行，竟然可以了</span><br><span class="line"></span><br><span class="line">3）在linux中的权限转换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">也可在Linux中转换：</span><br><span class="line"></span><br><span class="line">首先要确保文件有可执行权限</span><br><span class="line"></span><br><span class="line">#chmod u+x filename</span><br><span class="line"></span><br><span class="line">然后修改文件格式</span><br><span class="line"></span><br><span class="line">#vi filename</span><br><span class="line"></span><br><span class="line">三种方法都可以方便快速的解决关于Linux执行.sh文件，提示No such file or directory这个问题了。</span><br></pre></td></tr></table></figure>

<p>如果要清理缓存</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -p 6379	<span class="comment">#登录redis</span></span><br><span class="line">redis&gt; auth 123456	<span class="comment">#在redis命令行输入密码</span></span><br><span class="line">redis&gt; flushall	<span class="comment">#在redis命令行清除缓存</span></span><br></pre></td></tr></table></figure></div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>