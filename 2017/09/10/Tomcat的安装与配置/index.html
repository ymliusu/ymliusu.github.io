<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/favicon.ico"><title>Tomcat的安装与配置</title><script src="/js/baidu_analytics.js"></script></head><body>　　<div class="inner"><h2>Tomcat的安装与配置</h2><p>tomcat安装本身不难，主要是一些配置的修改。</p>
<h2><span id="1解压">1.解压</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf apache-tomcat-8.0.32.tar.gz</span><br></pre></td></tr></table></figure>

<h2><span id="2启动">2.启动</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd apache-tomcat-8.0.32/bin/</span><br><span class="line">$ ./startup.sh</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2><span id="3配置">3.配置</span></h2><p>配置内存大小:<br>linux在catalina.sh中加入<br><code>JAVA_OPTS=&quot;$JAVA_OPTS -Xms512m -Xmx1024m -XX:PermSize=512M -XX:MaxPermSize=512m&quot;</code><br>位置在<strong>cygwin=false</strong>这一行之前。</p>
<p>windows在catalina.bat中加入<br><code>set JAVA_OPTS=%JAVA_OPTS% -server -XX:PermSize=128m -XX:MaxPermSize=512m</code><br>位置在<strong>rem —– Execute The Requested Command —————————————</strong> 之后</p>
<p>配置用户：<br>在tomcat-users.xml中加入 ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-script"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-jmx"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-status"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"Fengdai2016"</span> <span class="attr">roles</span>=<span class="string">"manager-gui,manager-status"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体详细介绍如下 ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">在配置好Tomcat7/8后，我们往往需要访问Tomcat7/8的Manager以及Host Manager。就需要在tomcat-users.xml中配置用户角色来实现。</span><br><span class="line">在地址栏输入：localhost:8080访问 Tomcat，在打开的界面中，在右上角有这样三个按钮：</span><br><span class="line">　　1. Server Status</span><br><span class="line">　　2. Manager App</span><br><span class="line">　　3. Host Manager</span><br><span class="line">　　</span><br><span class="line">可是在我们配置好tomcat-users.xml后，这三个按钮往往不能都访问，要么是只能访问其中一个，或者就是两个。</span><br><span class="line">出现这种问题很有可能是你在配置中，角色没有添加全，尤其是在第三个按钮的配置上，</span><br><span class="line">第三个按钮的配置Tomcat7和Tomcat8的配置是不相同的。</span><br><span class="line">为了实现配置让三个按钮都能访问到，我们先看下tomcat-users.xml里面的一段用户配置：</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tomcat-users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-script"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"tomcat"</span> <span class="attr">password</span>=<span class="string">"tomcat"</span> <span class="attr">roles</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">roles</span>=<span class="string">"manager-script"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tomcat-users</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"角色名"</span>&gt;</span>这个是用来定义角色的，很明显rolename的属性值并不是我们随意写的。实际上，</span><br><span class="line">  Tomcat已经为我们定义了4种不同的角色，也就是4个rolename，</span><br><span class="line">  我们只需要使用Tomcat为我们定义的这几种角色就足够满足我们的工作需要了。</span><br><span class="line"></span><br><span class="line">manager-gui     #允许访问html接口(即URL路径为/manager/html/*)</span><br><span class="line">manager-script   #允许访问纯文本接口(即URL路径为/manager/text/*)</span><br><span class="line">manager-jmx   #允许访问JMX代理接口(即URL路径为/manager/jmxproxy/*)</span><br><span class="line">manager-status   #允许访问Tomcat只读状态页面(即URL路径为/manager/status/*)</span><br><span class="line"></span><br><span class="line">　　特别需要说明的是：manager-gui、manager-script、manager-jmx均具备manager-status的权限，</span><br><span class="line">也就是说，manager-gui、manager-script、manager-jmx三种角色权限无需再额外添加manager-status权限，</span><br><span class="line">即可直接访问路径”/manager/status/*”。</span><br><span class="line">　　</span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"用户名"</span> <span class="attr">password</span>=<span class="string">"密码"</span> <span class="attr">roles</span>=<span class="string">"角色（可多个）"</span>/&gt;</span>这个很简单，就是用来表示用户的，</span><br><span class="line">其中roles对应的就是上面定义的角色，可以有多个角色，多个角色用“，”隔开即可。也可以配置多个用户。</span><br><span class="line"></span><br><span class="line">需要访问前两个按钮，只需配置manager-*（4个按需配置）即可。</span><br><span class="line">需要访问第三个按钮，需要配置 admin-gui（HTML UI接口）或admin-script（纯文本接口）。</span><br><span class="line">如果都要访问，配置在一起即可。</span><br><span class="line">下面根据Tomcat7和Tomcat8分别贴出用户配置：</span><br><span class="line">1、Tomcat7访问Server Status、Manager App、Host Manager的配置。</span><br><span class="line"></span><br><span class="line">声明：此配置不注重安全性，只是测试。具体根据需求可删减</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-script"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-gui"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-script"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-jmx"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"manager-status"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin"</span> <span class="attr">roles</span>=<span class="string">"admin,admin-gui,admin-script,manager-gui,manager-script,manager-jmx,manager-status"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">2、Tomcat8访问Server Status、Manager App、Host Manager的配置。</span><br><span class="line"></span><br><span class="line">声明：此配置不注重安全性，只是测试。具体根据需求可删减</span><br><span class="line">Tomcat8如果在上面配置的基础上，访问时会报403错误，所以需要修改，如果没有的话新建conf/Catalina/localhost/manager.xml 文件。</span><br><span class="line">配置内容如下：</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">privileged</span>=<span class="string">"true"</span> <span class="attr">antiResourceLocking</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">docBase</span>=<span class="string">"$&#123;catalina.home&#125;/webapps/manager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.RemoteAddrValve"</span> <span class="attr">allow</span>=<span class="string">"^.*$"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></span><br><span class="line"></span><br><span class="line">以上经过亲测，如果配置好后还提示404或403错误，欢迎留言！</span><br></pre></td></tr></table></figure>

<p>上述参考<a href="http://blog.csdn.net/weixian52034/article/details/53218584" target="_blank" rel="noopener">地址</a></p>
<h2><span id="4修改deploy文件大小限制">4.修改deploy文件大小限制</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd webapps/manager/WEB-INF/</span><br><span class="line">$ vi web.xml</span><br></pre></td></tr></table></figure>

<p>大概在50行处修改：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">multipart-config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 50MB max --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max-file-size</span>&gt;</span>52428800<span class="tag">&lt;/<span class="name">max-file-size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">max-request-size</span>&gt;</span>52428800<span class="tag">&lt;/<span class="name">max-request-size</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">file-size-threshold</span>&gt;</span>0<span class="tag">&lt;/<span class="name">file-size-threshold</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">multipart-config</span>&gt;</span></span><br></pre></td></tr></table></figure></div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>